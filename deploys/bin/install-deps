#
# Copyright (c) 2017 ISPRAS (http://www.ispras.ru)
# Institute for System Programming of the Russian Academy of Sciences
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

import os
import subprocess

os.environ['DEBIAN_FRONTEND'] = 'noninteractive'


def execute_cmd(*args):
    print('Execute command "{0}"'.format(' '.join(args)))
    subprocess.check_call(args)

execute_cmd('apt-get', 'update')

execute_cmd('apt-get', 'upgrade', '-y')

execute_cmd(
    'apt-get', 'install', '-y',
    # For Klever Bridge.
    'postgresql', 'libpq-dev', 'python3-dev', 'python3-pip', 'nginx', 'gettext',
    # For Klever Core.
    'bc', 'git', 'make', 'graphviz',
    # For building the Linux kernel.
    'libc6-dev-i386',
    # For CPAchecker 1.6+.
    'openjdk-8-jre-headless'
)

execute_cmd(
    'pip3', 'install', '-U',
    # For Klever Bridge.
    'Django', 'psycopg2', 'gunicorn', 'pytz',
    # For Klever Core.
    'jinja2', 'graphviz', 'ply', 'requests', 'setuptools_scm', 'pympler',
    # For Klever Scheduler.
    'consulate'
)
