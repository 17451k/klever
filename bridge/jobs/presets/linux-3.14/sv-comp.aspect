/* allocation of space */
pointcut ALLOC: call(static inline void *kmalloc(size_t size, gfp_t flags))
/* allocation of space which is initialized to all bits zero*/
pointcut ZALLOC: call(static inline void *kzalloc(size_t size, gfp_t flags))

before: file ("$this")
{
#include <linux/kernel.h>
void *ldv_malloc(size_t size);
void *ldv_zalloc(size_t size);
void *memset(void *s, int c, size_t n);
}

around: ALLOC
{
  return ldv_malloc(size);
}

around: ZALLOC
{
  return ldv_zalloc(size);
}

around: define(memset(p,v,n)) {memset(p,v,n)}
