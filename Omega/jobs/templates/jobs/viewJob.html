{% extends 'jobs/base.html' %}

{% load i18n %}

{% load tz %}

{% block jobs_head_block %}<script src="/static/jobs/js/editjob.js"></script>{% endblock %}

{% block title %}{% trans 'Job' %}{% endblock %}

{% block body_block %}
    {% if jobdata.job %}
    <div class="row">
        <div class="col-sm-5">
            <div class="form-inline">
                <div class="btn-group" role="group">
                    {% if can_create %}<button id="copy_job_btn" class="btn btn-info">{% trans 'Make copy' %}</button>{% endif %}
                    <button id="load_job_btn" class="btn btn-success">{% trans 'Download' %}</button>
                    {% if can_edit %}
                        <button id="edit_job_btn" class="btn btn-primary">{% trans 'Edit' %}</button>
                        <button id="edit_versions" class="btn btn-warning">{% trans 'Delete versions' %}</button>
                    {% endif %}
                    {% if can_delete %}<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#remove_job_popup">{% trans 'Delete' %}</button>{% endif %}
                </div>
                <span id="job_pk" hidden>{{ jobdata.job.pk }}</span>
            </div>

            <h4><span class="show-job-name show-job-title"><ins>{{ jobdata.job.name }}</ins></span></h4>

            <span class="show-job-title">{% trans 'Class' %}:</span> {{ jobdata.job.get_type_display }}
            <br>
            <span class="show-job-title">{% trans 'Identifier' %}:</span> <span style="color: #15c46b">{{ jobdata.job.identifier }}</span>
            <br><span class="show-job-title">{% trans 'Created by' %}: </span>
            <a href="{% url 'users:show_profile' created_by.pk %}">{{ created_by.extended.last_name }} {{ created_by.extended.first_name }}</a>
            <br>
            {% if parents %}
                <span class="show-job-title">{% trans 'Parents' %}:</span>
                {% for parent in parents %}
                    <ul><li>
                    {% if parent.pk %}
                        <a href="{% url 'jobs:job' parent.pk %}">{{ parent.name }}</a>
                    {% else %}
                        <ins>{{ parent.name }}</ins>
                    {% endif %}
                {% endfor %}
                {% for parent in parents %}
                    </li></ul>
                {% endfor %}
            {% endif %}

            {% if children %}
                <span class="show-job-title">{% trans 'Children' %}:</span>
                <ul>
                {% for child in children %}
                    <li>
                        {% if child.pk %}
                            <a href="{% url 'jobs:job' child.pk %}">{{ child.name }}</a>
                        {% else %}
                            <span><ins>{{ child.name }}</ins></span>
                        {% endif %}
                    </li>
                {% endfor %}
                </ul>
            {% endif %}

            <span class="show-job-title">{% trans 'Last change' %}: </span>
            <br>
            <span class="job-subtitle">{% trans 'Author' %}: </span><a href="{% url 'users:show_profile' jobdata.job.change_author.pk %}">{{ jobdata.job.change_author.extended.last_name }} {{ jobdata.job.change_author.extended.first_name }}</a>
            <br>
            <span class="job-subtitle">{% trans 'Date' %}: </span>
            {% timezone user.extended.timezone %}
                {{ jobdata.job.change_date|date:'d.m.y H:i:s' }}
            {% endtimezone %}
            {% if comment|length %}
                <br>
                <span class="job-subtitle">{% trans 'Comment' %}:</span> <small>"{{ comment }}"</small><br>
            {% endif %}
            <br>
            <span class="show-job-title">{% trans 'Decision status' %}: </span>
            {% if jobdata.job.jobstatus %}
                <span style="color:
                        {% if job.jobstatus.status == '0' %}
                            #887AB8
                        {% elif job.jobstatus.status == '1' %}
                            #FF8533
                        {% elif job.jobstatus.status == '2' %}
                            #335CD6
                        {% elif job.jobstatus.status == '3' %}
                            #00E600
                        {% elif job.jobstatus.status == '4' %}
                            #CC0000
                        {% endif %}
                ">
                    {% if jobdata.job.reportroot %}
                        <a href="{% url 'reports:report_root' jobdata.job.reportroot.id %}">{{ jobdata.job.jobstatus.get_status_display }}</a>
                    {% else %}
                        <ins>{{ jobdata.job.jobstatus.get_status_display }}</ins>
                    {% endif %}
                </span>
            {% else %}
                -
            {% endif %}
            {% include 'jobs/viewJobFilters.html' %}
            <div class="row">
                {% if jobdata.view_data.unsafes|length %}
                    <div class="col-sm-6">
                        <span class="show-job-title"><b>{% trans 'Unsafes' %}: </b></span>
                        <ul>
                            {% for v in jobdata.view_data.unsafes %}
                                <li><span style="color:{{ v.color }};">{{ v.title }}: </span><a href="#">{{ v.value }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                {% if jobdata.view_data.safes|length %}
                    <div class="col-sm-6">
                        <span class="show-job-title"><b>{% trans 'Safes' %}: </b></span>
                        <ul>
                            {% for v in jobdata.view_data.safes %}
                                <li><span style="color:{{ v.color }};">{{ v.title }}: </span><a href="#">{{ v.value }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>

            {% if jobdata.view_data.unknowns|length %}
                <span class="show-job-title"><b>{% trans 'Unknowns' %}</b></span>
                {% if jobdata.unknowns_total %}(<a href="#">{{ jobdata.unknowns_total }}</a>){% endif %}
                <ul>
                    {% for comp in jobdata.view_data.unknowns %}
                        <li>{{ comp.component }}</li>
                        <ul>
                        {% for probl in comp.problems %}
                            <li>{{ probl.problem }}: <a href="#">{{ probl.num }}</a></li>
                        {% endfor %}
                        </ul>
                    {% endfor %}

                </ul>
            {% endif %}

            {% if jobdata.view_data.resources|length %}
                <span id="resource_title_span" class="show-job-title"><b>{% trans 'Resources' %}*</b></span>
                <ul>
                    {% for res_data in jobdata.view_data.resources %}
                        <li>{{ res_data.component }}: <span style="color: darkblue">{{ res_data.val }}</span></li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if jobdata.show_tags %}
                {% if jobdata.view_data.tags_unsafe|length or jobdata.view_data.tags_safe|length %}
                    <br><span class="show-job-title"><b>{% trans 'Tags' %}</b></span>
                    <div class="row">
                        {% if jobdata.view_data.tags_unsafe|length %}
                            <div class="col-sm-6">
                                <span class="show-job-title"><small>{% trans 'Unsafe' %}: </small></span>
                                <ul>
                                    {% for t in jobdata.view_data.tags_unsafe %}
                                        <li><span>{{ t.name }}: </span><a href="{{ t.href }}">{{ t.number }}</a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        {% if jobdata.view_data.tags_safe|length %}
                            <div class="col-sm-6">
                                <span class="show-job-title"><small>{% trans 'Safe' %}: </small></span>
                                <ul>
                                    {% for t in jobdata.view_data.tags_safe %}
                                        <li><span>{{ t.name }}: </span><a href="{{ t.href }}">{{ t.number }}</a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endif %}

            <div id="resource_star_div">
                <hr>
                <small style="color: #868686">*{% trans "Resources (wall time, CPU time and maximum memory) are shown for each component and totally" %}</small>
            </div>
        </div>
        <div id="edit_job_div" class="col-sm-7"></div>
    </div>
        {% if can_delete %}
            <div id="remove_job_popup" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">{% trans 'Are you sure' %}?</h4>
                        </div>
                        <div class="modal-body">
                            <p>{% trans 'All versions and all data of this job will be deleted' %}</p>
                        </div>
                        <div class="modal-footer">
                            <button id="remove_job_btn" type="button" class="btn btn-warning" style="float: left;" data-dismiss="modal">{% trans 'Delete' %}</button>
                            <button type="button" class="btn btn-info" data-dismiss="modal">{% trans 'Cancel' %}</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endif %}
{% endblock %}
