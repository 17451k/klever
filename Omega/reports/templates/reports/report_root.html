{% extends 'reports/base.html' %}

{% load i18n %}

{% load tz %}

{% block body_block %}

<div class="row">
    <div class="col-sm-7">
        <span class="Title">{% trans 'General information' %}</span>
        <table class="RootReportTable" border="1">
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Report identifier' %}</span></td>
                <td>{{ report.identifier }}</td>
            </tr>

            {% if report.user %}
            <tr class="TableRawOdd">
                <td><span class="TableTitle">{% trans 'Author' %}</span></td>
                <td>
                    <a href="{% url 'users:show_profile' report.user.id %}">{{ report.user.username }}</a>
                </td>
            </tr>
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Verification Job' %}</span></td>
                <td>
                    <a href="{% url 'jobs:job' report.job.id %}">{{ report.job.identifier }}</a>
                </td>
            </tr>
            <tr class="TableRawOdd">
                <td><span class="TableTitle">{% trans 'Status' %}</span></td>
                <td>
                    {{ report.job.jobstatus.get_status_display }}
                </td>
            </tr>
            {% endif %}
            {% timezone user.extended.timezone %}
            {% if report.user %}
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Last request date' %}</span></td>
                <td>
                    {{ report.last_request_date }}
                </td>
            </tr>
            {% endif %}
            <tr class="TableRawOdd">
                <td><span class="TableTitle">{% trans 'Start date' %}</span></td>
                <td>
                    {{ report.start_date }}
                </td>
            </tr>
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Finish date' %}</span></td>
                <td>
                    {{ report.finish_date }}
                </td>
            </tr>
            {% endtimezone %}
            <tr class="TableRawOdd">
                <td><span class="TableTitle">{% trans 'Duration' %}</span></td>
                <td>
                    {{ delta }}
                </td>
            </tr>
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Computer' %}</span></td>
                <td>
                    {{ report.computer.description }}
                </td>
            </tr>
        </table>

        <br><span class="Title">{% trans 'Attributes' %}</span>
        <table class="RootReportTable" border="1">
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Name' %}</span></td>
                <td><span class="TableTitle">{% trans 'Value' %}</span></td>
            </tr>
            {% for attr in report.attr.all %}
            <tr class="TableRawOdd">
                <td>{{attr.name.name}}</td>
                <td>{{attr.value}}</td>
            </tr>
            {% endfor %}
        </table>

        <br><span class="Title">{% trans 'Resources' %}</span>
        <table class="RootReportTable" border="1">
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Component' %}</span></td>
                <td><span class="TableTitle">{% trans 'CPU time' %}</span></td>
                <td><span class="TableTitle">{% trans 'Wall time' %}</span></td>
                <td><span class="TableTitle">{% trans 'Memory' %}</span></td>
            </tr>
            {% for resource in resources %}
            <tr class="TableRawOdd">
                {% if resource.component.name %}
                    <td>{{ resource.component.name }}</td>
                {% else %}
                    <td>Total</td>
                {% endif %}
                <td>{{ resource.resource.cpu_time }}</td>
                <td>{{ resource.resource.wall_time }}</td>
                <td>{{ resource.resource.memory }}</td>
            </tr>
            {% endfor %}
        </table>

        {% if parents %}
        <br><span class="Title">{% trans 'Parents' %}</span>
        <table class="RootReportTable" border="1">
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Component' %}</span></td>
                {% for attr in parents_attr %}
                    <td><span class="TableTitle">{{ attr.name }}</span></td>
                {% endfor %}
            </tr>
            {% for parent, attr_values in parents.items %}
                <tr class="TableRawOdd">

                {% if not parent.parent %}
                    <td><a href="{% url 'reports:report_root' parent.id %}">{{ parent.component.name }}</a></td>
                {% else %}
                    <td><a href="{% url 'reports:report_component' parent.id %}">{{ parent.component.name }}</a></td>
                {% endif %}

                {% for attr in attr_values %}
                    {% if attr %}
                        <td>{{ attr.0.value }}</td>
                    {% else %}
                        <td></td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        {% if children_values %}
        <br><span class="Title">{% trans 'Children' %}</span>
        <table class="RootReportTable" border="1">
            <tr class="TableRawEven">
                <td><span class="TableTitle">{% trans 'Component' %}</span></td>
                {% for attr in children_attr %}
                    <td><span class="TableTitle">{{ attr.name }}</span></td>
                {% endfor %}
            </tr>
            {% for child, attr_values in children_values.items %}
                <tr class="TableRawOdd">

                <td><a href="{% url 'reports:report_component' child.id %}">{{ child.component.name }}</a></td>

                {% for attr in attr_values %}
                    {% if attr %}
                        <td>{{ attr.0.value }}</td>
                    {% else %}
                        <td></td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        <span class="Title">{% trans 'Log' %}</span>
        {% if report.description %}
            <br><p class="purple-title">{% trans 'Description' %}</p>
            {{ report.description }}
        {% endif %}
        <br>{{report.log}}

    </div>
    <div class="col-sm-5">
        {% include 'jobs/jobData.html' %}
    </div>
</div>
{% endblock %}